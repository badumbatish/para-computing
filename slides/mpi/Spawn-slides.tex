% -*- latex -*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%
%%%% This text file is part of the lecture slides for
%%%% `Parallel Computing'
%%%% by Victor Eijkhout, copyright 2012-2021
%%%%
%%%% Spawn-slides.tex : slides about MPI process management
%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\Level 1 {Process spawning}

\begin{numberedframe}{Overview}
  This section discusses processes management; intra communicators.

  Commands learned:
  \begin{itemize}
  \item \indexmpishow{MPI_Comm_spawn}, \indexmpishow{MPI_UNIVERSE_SIZE}
  \item \indexmpishow{MPI_Comm_get_parent}, \indexmpishow{MPI_Comm_remote_size}
  \end{itemize}
\end{numberedframe}

\begin{numberedframe}{Process management}
  \begin{itemize}
  \item PVM was a precursor of MPI: could dynamically create new
    processes.
  \item It took MPI a while to catch up.
  \item Use \indexmpishow{MPI_Attr_get} to retrieve
    \indexmpishow{MPI_UNIVERSE_SIZE} attribute indicating space for
    creating more processes outside \indexmpishow{MPI_COMM_WORLD}.
  \item New processes have their own \indexmpishow{MPI_COMM_WORLD}.
  \item Communication between the two communicators: `inter
    communicator'\\ (the old type is `intra communicator')
  \end{itemize}
\end{numberedframe}

\begin{numberedframe}{Space for processes}
  Probably a machine dependent component.

  Suggested standard:
\begin{verbatim}
mpiexec -n 4 -usize 8 spawn_manager
\end{verbatim}

  Intel MPI at TACC:
\begin{verbatim}
MY_MPIRUN_OPTIONS="-usize 8" ibrun -np 4 spawn_manager
\end{verbatim}
Discover size of the universe:
\begin{lstlisting}
MPI_Attr_get(MPI_COMM_WORLD, MPI_UNIVERSE_SIZE,
  (void*)&universe_sizep, &flag);
\end{lstlisting}
\end{numberedframe}

\begin{numberedframe}{Manager program}
  \footnotesize
  \cverbatimsnippet{spawnmanagerq}
\end{numberedframe}

\begin{numberedframe}{Manager program (cont'd)}
  \footnotesize
  \cverbatimsnippet{spawnmanager}
\end{numberedframe}

\begin{numberedframe}{Worker program}
  \cverbatimsnippet{spawnworker}
\end{numberedframe}

\begin{numberedframe}{Were you spawned?}
  \cverbatimsnippet{commparentdetect}
\end{numberedframe}

\Level 1 {The sessions model}

\begin{numberedframe}{World and session model}
  \begin{itemize}
  \item World model: what you have been doing so far;\\
    Start with \indexmpishow{MPI_COMM_WORLD} and
    make subcommunicators, \\
    or spawn new world communicators and bridge them
  \item Session model: have multiple sessions active.
  \end{itemize}
\end{numberedframe}

\begin{numberedframe}{Session model}
  \begin{itemize}
  \item Create a session;
  \item a session has multiple `process sets'
  \item from a process set you make a communicator;
  \item (Potentially create multiple sessions in one program run)
  \end{itemize}
\end{numberedframe}

\begin{numberedframe}{Session creating}
  \cverbatimsnippet{sessionreq}
  or \indexmpishow{MPI_INFO_NULL}, then
    \cverbatimsnippet{sessioninit}
\end{numberedframe}

\begin{numberedframe}{Session: process sets}
  Process sets, identified by name (not a data type):
  \cverbatimsnippet{sessionpsetq}
  the sets \n{mpi://SELF} and \n{mpi://WORLD} are always defined.
\end{numberedframe}

\begin{numberedframe}{Session: create communicator}
  Process set $\rightarrow$ group $\rightarrow$ communicator
  \cverbatimsnippet{sessioncommworld}
\end{numberedframe}

\begin{numberedframe}{Multiple sessions}
  \cverbatimsnippet{sessionmulti}
\end{numberedframe}

\endinput

\begin{numberedframe}{}
\begin{lstlisting}
\end{lstlisting}
\end{numberedframe}

\begin{numberedframe}{}
\begin{lstlisting}
\end{lstlisting}
\end{numberedframe}

\begin{numberedframe}{}
\begin{lstlisting}
\end{lstlisting}
\end{numberedframe}

\begin{numberedframe}{}
\begin{lstlisting}
\end{lstlisting}
\end{numberedframe}

\endinput

\begin{numberedframe}{}
\begin{lstlisting}
\end{lstlisting}
\end{numberedframe}

